{% load static %}
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>{{ post.title }}</title>
  <link rel="stylesheet" href="{% static 'blog/css/styles.css' %}">
</head>
<body>
  <p><a href="{% url 'posts-list' %}">&larr; Back to posts</a></p>
  <h1>{{ post.title }}</h1>
  <div>by {{ post.author.username }} â€” {{ post.published_date|date:"Y-m-d H:i" }}</div>
  <article>
    <p>{{ post.content|linebreaks }}</p>
  </article>
    {% if post.tags.all %}
    <p>Tags:
    {% for tag in post.tags.all %}
      <a href="{% url 'posts-by-tag' tag.slug %}">#{{ tag.name }}</a>{% if not forloop.last %}, {% endif %}
    {% endfor %}
    </p>
    {% endif %}
  <hr>

  <h2>Comments ({{ post.comments.count }})</h2>
  <ul style="list-style:none;padding-left:0;">
    {% for comment in post.comments.all %}
      <li style="margin-bottom:1rem;border-bottom:1px solid #eee;padding-bottom:0.5rem;">
        <div>
          <strong>{{ comment.author.username }}</strong>
          <small>on {{ comment.created_at|date:"Y-m-d H:i" }}{% if comment.updated_at > comment.created_at %} (edited){% endif %}</small>
        </div>
        <p>{{ comment.content|linebreaks }}</p>
        {% if user.is_authenticated and user.id == comment.author_id %}
          <p>
            <a href="{% url 'comment-edit' post.pk comment.pk %}">Edit</a> |
            <a href="{% url 'comment-delete' post.pk comment.pk %}">Delete</a>
          </p>
        {% endif %}
      </li>
    {% empty %}
      <li>No comments yet.</li>
    {% endfor %}
  </ul>

  {% if user.is_authenticated %}
    <h3>Add a comment</h3>
    <form method="post" action="{% url 'comment-create' post.pk %}">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit">Post Comment</button>
    </form>
  {% else %}
    <p><a href="{% url 'login' %}">Log in</a> to comment.</p>
  {% endif %}

  <hr>
  {% if user.is_authenticated and user.id == post.author_id %}
    <p>
      <a href="{% url 'posts-edit' post.pk %}">Edit Post</a> |
      <a href="{% url 'posts-delete' post.pk %}">Delete Post</a>
    </p>
  {% endif %}

</body>
</html>
